# Operating System

운영 체제는 애플리케이션 개발자(우리)를 대신하여 간섭하고 개발자와 하드웨어, CPU 사이의 상호작용을 돕는다.

- 사용자가 애플리케이션을 실행하면, 운영체제는 디스크에 있던 프로그램을 메모리로 가져와 프로그램의 인스턴스를 생성한다.

*이 인스턴스를 `프로세스`  또는 `애플리케이션 컨텍스트` 라고 부르기도한다.*

<br>

![Process.png](/img/Process.png)
각 프로세스는 시스템에서 실행되는 다른 프로세스와는 완전히 별개이다.

- 프로세스 안의 메타데이터에는 PID(애플리케이션이 읽고 쓰기 위해 여는 파일), files , Code(CPU에서 실행되는 프로그램 명령어), Heap(애플리케이션에 필요한 모든 데이터가 들어있음), Main Thread(스레드가 적어도 하나이상 존재)가 존재한다.

<br>

스레드는 크게 두가지(스택, 명령어 포인터)를 갖고 있다.

- 멀티 스레드 애플리케이션에서는 각각의 스레드는 자체 스택과 멸령어 포인터를 가지지만, 프로세스 내의 나머지 컴포넌트는 모든 스레드가 공유한다.
- 스택: 메모리 영역으로 지역변수가 저장되고 기능이 실행되는 영역을 말한다.
- 명령어 포인터: 스레드가 실행할 다음 명령어의 주소를 가리키는 역할을 한다.

<br>

스레드가 자체 스택과 명령어 포인터를 갖는 이유는 다음과 같다.

- 각각의 스레드는 특정 순간에 서로 다른 함수를 이용해 다른 명령을 수행하기 위해 자체 스택과 명령어 포인터를 갖는다.

<br><hr><hr>

## **Context Switch**

*하나의 스레드 실행을 멈추고 다른 스레드를 스케줄링한 다음 다시 실행하는 것을 컨텍스트 스위치라 말한다.*

![ThreadCompeting.png](/img/ThreadCompeting.png)

애플리케이션의 각각의 인스턴스는 다른 프로세스와는 독립적으로 실행된다.

- 일반적으로 코어보다 프로세스가 훨씬 많고 각각의 프로세스는 하나 이상의 스레드를 갖는다.
- 모든 스레드는 CPU 실행에 서로 경쟁한다.
- 코어가 여러 개라 하더라도 스레드가 코어보다 많다.
- 운영체제는 스레드 하나를 실행하고, 멈추고를 반복한다.

<br>

컨텍스트 스위치는 동시에 많이 스레드를 다룰경우 효율성이 떨어지기 때문에 중요하다.(병행성에 대한 트레이드오프)

- CPU에서 실행되는 각 스레드는 CPU 내의 레지스터나 캐시 메모리 내의 커널 리소스 같은 것을 일정 부분 차지하게 된다.
- 다른 스레드로 전환 할 때는 기족의 데이터를 저장하고, 또 다른 스레드의 리소스를 CPU와 메모리에 복원해야한다.
- 즉, 너무 많은 스레드는 가동하게 되면 Thrashing(컨텍스트 스위치에 더 많은 시간을 할애하는 것을 말한다.)가 발생한다.

<br>

스레드는 프로세스보다 리소스를 더 적게 사용한다.

- 같은 프로세스에 속한 두 스레드 간의 컨텍스트 스위치가 각각 다른 프로세스의 두 스레드간의 컨텍스트 스위치보다 효율적이다.

<br><hr><hr>
