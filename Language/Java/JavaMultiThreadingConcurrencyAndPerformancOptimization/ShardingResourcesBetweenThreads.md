# **Sharing Resources Between Threads**

![ProcessWithContext.png](/img/ProcessWithContext.png)

**메모리 관리** 는 멀티스레드 애플리케이션을 써서 `일관적`이고 `정확한` 결과 및 뛰어난 `성능`을 얻기 위해 확실한 이해가 필요하다.

- `객체`, `클래스 멤버` 그리고 `정적 변수`는 `힙`에 할당되고 `스레드`에서 `공유`된다.
- `로컬 변수`는 `원시 타입`이든 `로컬 레퍼런스`이든 `스택`에 할당되고 **특정 스레드에만** 속한다.

<br><hr><hr>

## 스**택(Stack) 메모리 영역**

특정 스레드에는 각 `스택` 영역이 존재한다.

- 스택은 `메서드`가 실행되는 메모리 영역이다.
- 함수에 **인수를 입력할 때마다** 스택에 입력되고 모든 로컬 변수 또한 스택에 저장된다.
- 각 스레드가 다른 코드 라인 또는 메서드를 실행할 수 있어, `스택`과 `명령어 포인터`를 통해 **스레드의 실행 상태**를 알수 있다.

<br>

> ### **스택 사용방법**

- 모든 메서드 프레임이 할당되고, `후입 선출` 순서로 무효화가 일어난다.(**=스택과 같다.**)
- 스택에 입력된 모든 변수는 특정 스레드에 속하기에 **다른 스레드는 변수에 접근 불가** 하다.
- 스레드가 생성될 때 스택은 정적으로 할당되기 때문에 **고정된 크기** 를 갖고 런타임을 변경할 수 없다.
- **너무 많은 메서드 호출을 중첩하여 호출 계층 구조가 너무 길면**, 스택에 할당된 메모리가 고갈되고 `StackOverflow`가 발생한다.

    *`재귀` 메서드를 사용할 때 조심하자.*

<br><hr><hr>

## **힙(Heap) 메모리 영역**

`힙`은 처리에 속하는 `공유 메모리 영역`으로 모든 `스레드`가 `힙`에 있는 **모든 데이터를 공유하고 언제나 힙에 객체를 할당하거나 그 객체에 접근할 수 있다.**

- 모든 `객체`는 `힙`에 저장된다.
- 새로운 연산자를 사용하여 할당할 수 있는 객체는 모두 포함되고, **객체에 속한 모든 것**도 힙에 저장된다.
- 객체 그 `자체`이든 `원시 멤버`이든 상관 없이 저장된다.
- `정적 변수` 또한 `힙`에 할당된다.(정적 변수가 클래스와 관련된 클래스 객체의 멤버이기 때문이다.)
- 객체는 **레퍼런스가 최소 하나라도** 있으면 `힙`에 머무른다.
- 객체의 모든 레러펀스가 사라지면 가비지가 수거된다.
- 멤버 변수는 부모 객체와 묶이며 **부모 객체와 같은 수명 주기**를 갖는다.

<br>

> ### **레퍼런스(References)와 객체(Object)의 차이**

![reference.png](/img/reference.png)

```java
Object referenceVar1 = new Object();
Object referenceVar2 = new Object();
```

- 현재 별개의 3개의 객체 중, **두개는 레퍼런스 변수**이고, 하나는 레퍼런스 변수가 가리키는 **단일 객체**이다.
- 레퍼런스가 `메서드`에 `로컬변수`로 선언되면 레퍼런스는 `스택`에 할당된다.
- `클래스의 멤버`일 경우 `부모객체`와 함께 `힙`에 할당된다.