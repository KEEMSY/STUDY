# **Sharding**

샤딩은 클러스터의 여러 서버 또는 노드에서 **데이터를 수평으로 분할**하기 위해 데이터베이스 아키텍처에서 사용되는 기술로, 특히 **대규모 분산 시스템**에서 데이터베이스를 **확장** 하고 **성능** 을 향상시키는 강력한 기술이다.

- 데이터 양이 많거나 트랜잭션 속도가 높은 시스템에서 데이터베이스의 `확장성`과 `성능`을 향상시키기 위해 수행된다.
- 샤딩된 데이터베이스에서 데이터는 **샤드** 라고 하는 더 작고 관리하기 쉬운 하위 집합으로 나뉜다.
- 샤드를 통해 요청 및 쿼리의 병렬 처리가 가능하여 전반적인 성능과 확장성이 향상된다.
- 샤딩은 특정 데이터베이스 시스템 및 애플리케이션의 요구 사항에 따라 **다양한 방법**으로 구현될 수 있다.

<br>

## **종류**

샤딩의 일반적인 방법으로는 범위 기반 샤딩, 해시(모듈)기반 샤딩을 이야기 할 수 있다. 

> **범위 기반 샤딩**

- 특정 **속성** 또는 **키 범위**를 기반으로 데이터를 나눈다.
- 쿼리가 적절한 샤드로 직접 라우팅될 수 있기 때문에 범위 쿼리 또는 데이터 하위 집합에 액세스해야 하는 쿼리의 경우 더 빠를 수 있다. 
- 하지만, 쿼리 라우팅에 대해 더 예측 가능할 수 있지만 특정 특성에 더 많은 데이터가 있는 경우 데이터가 고르지 않게 분산될 수 있다.

> **해시(모듈) 기반 샤딩**

- **해싱** 기능을 사용하여 노드 전체에 데이터를 **무작위로 배포** 하여 데이터를 나눈다.
- 모듈 기반 샤딩은 해시 함수가 모든 샤드에 데이터를 고르게 분산할 수 있기 때문에 임의 액세스 또는 특정 범위가 없는 쿼리의 경우 더 빠를 수 있다.
- 하지만, 특정 쿼리가 액세스해야 하는 샤드를 예측하기 어려울 수 있다.


<br>

## **문제 및 해결 방법**

샤딩은 `확장성`과 `성능` 측면에서 상당한 이점을 제공할 수 있지만 추가적인 `복잡성`과 `관리 오버헤드`도 발생시킨다. 우리는 데이터 `일관성` 또는 `쿼리 효율성`을 손상시키지 않고 샤딩의 `확장성`과 `성능` 이점을 얻을 수 있도록 노력해야 한다.

> **데이터 일관성**

샤딩으로 인해 여러 노드에서 `데이터 일관성`을 유지하기가 더 어려워질 수 있다. 데이터가 제대로 배포되지 않거나 복제 또는 동기화에 문제가 있는 경우 데이터 불일치 및 오류가 발생할 수 있다.

- 솔루션

    이 문제를 해결하기 위해 개발자는 **분산 잠금** 또는 **트랜잭션**을 사용하여 데이터 수정이 모든 노드에서 `원자적`이고 `일관성`이 있는지 확인할 수 있다. 또한 강력한 복제 및 동기화 메커니즘을 구현하여 모든 노드에서 데이터의 `일관성`을 유지하는 것도 중요하다.

> **쿼리 복잡성**

 쿼리가 여러 노드로 라우팅되고 잠재적으로 **샤드 간에 조인**되어야 하므로 샤딩은 쿼리 실행을 더욱 복잡하게 만들 수 있다. 이로 인해 **대기 시간** 이 증가하고 `성능`이 저하될 수 있다.

- 솔루션

    이 문제를 해결하기 위해 개발자는 데이터의 위치와 각 노드의 로드를 고려하는 **쿼리 라우팅 알고리즘**을 사용하여 쿼리가 최대한 효율적으로 실행되도록 할 수 있다. **교차 샤드 쿼리** 의 필요성을 최소화하는 데이터 모델 및 파티셔닝 체계를 설계하는 것도 중요합니다.


> **샤딩 오버헤드**

앞서 언급했듯이 샤딩은 **추가 관리**, **개발 및 운영 오버헤드**를 도입하여 시스템의 `복잡성`과 `비용`을 증가시킬 수 있다.

- 솔루션

    이 문제를 해결하기 위해 **샤드 재조정** 및 **확장**과 같은 관리 작업을 **자동화**할 수 있습니다. 또한 기본적으로 샤딩 지원을 제공하는 개발 프레임워크 및 라이브러리를 사용하여 필요한 사용자 지정 코드의 양을 줄일 수 있다.
