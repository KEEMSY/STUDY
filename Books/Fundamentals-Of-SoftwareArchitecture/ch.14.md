# **CHAPTER 14 이벤트 기반 아키텍처 스타일**

이벤트 기반 아키텍처(event-driven-architecture) 는 확장성이 뛰어난 고성능 애플리케이션 개발에 널리 쓰이는 비동기 분산 아키텍처 스타일이다.

- 이벤트기반 아키텍처는 적응성이 매우좋아, 소규모 애플리케이션 부터 크고 복잡한 애플리케이션 까지 두루 사용할 수 있다.
- 이벤트를 비동기 수신/처리하는 별도의 이벤트 처리 컴포넌트들로 구성한다.
- 스탠드얼론 아키텍처 스타일로 사용하거나 다른 아키텍처 스타일에 내장할 수 있다.

<br>


![modelBasedOnRequest](/img/modelBasedOnRequest.png)

대부분 요청 기반 모델(request-based model)을 따른다.

- 액션을 수행하도록 시스템에 요청하면 요청 오케스트레이터(request orchestrator)가 접수한다.
- 요청 오케스트레이터는 보통 유저 인터페이스 이지만 API레이어나 엔터프라이즈 서비스로도 구현할 수 있다.

*요청 오케스트 레이터(컴포넌트)의 임무는 다양한 요청 프로세서(request processor)에 확정적으로(deterministically), 동기적으로(synchronously) 요청을 전달하는 일이다. 요청 프로세서는 요청을 받아 데이터베이스에서 정보를 조회/수정하는 등의 작업을 수행하는 식으로 요청을 처리한다.*

<br>

시스템에서 유저가 주문이력을 요청할 경우 주문 이력 조회는 특정한 콘텍스트에서 시스템에 데이터를 달라고 전달된, 데이터 기반의 확정적인 요청이지, 시스템이 반응해야할 이벤트가 발생한 것은 아니다.

<br>

이벤트 기반 모델은 특정한 상황에 대응하여 그 이벤트에 알맞게 액션을 취한다.

- 경매사이트에서 입찰자가 어떤 항목에 입찰을 할 경우, 입찰을 하는 행위는 시스템에 무엇인가 요청을 하는 것보다는, 현재 가격이 발표된 직후에 발생하는 이벤트에 더 가깝다.
- 시스템은 이 이벤트에 반응하여 동시 발생한 달느 입찰가와 비교 후 현재까지 누가 가장 높은 가격을 부른 입찰자인지 결정할 수 있다.


<br><hr><hr>

## **토폴로지**

이벤트 기반 아키텍처의 주요 토폴로지는 다음과 같다. 두 토폴로지의 아키텍처 특성과 구현 전략은 서로 다르기 때문에 주어진 상황에 가장 알맞은 것은 선택하기위해 각각의 특징을 잘 파악하도록한다.

- 중재자 토폴로지(mediator topology): 이벤트 처리 워크플로를 제어해야 할 경우 사용한다.
- 브로커 토폴로지(broker topology): 신속한 응답과 동적인 이벤트 처리 제어가 필요할 경우 사용된다.

<br>

### **브로커 토폴로지**

![brokerTopology](/img/brokerTopology.png)

브로커 토폴로지는 중앙에 이벤트 중재자가 없다는 점에서 중재자 토포롤지와 다르다.

- 메시지는 경량 메시지 브로커를 통해 브로드캐스팅이되어 이벤트 프로세서 컴포넌트에 분산되어 들어간다.
- 비교적 이벤트 처리 흐름이 단순하고 굳이 중앙에서 이벤트를 조정할 필요가 없다.

<br>

브로커 토폴로지는 다음 4개의 기본 아키텍처 컴포넌트로 구성된다.

- 시작 이벤트 
- 이벤트 브로커 
- 이벤트 프로세서
- 처리 이벤트


<br>

> ### 시작 이벤트

단순한 이벤트 또는 복잡한 이벤트와 같이 전체 이벤트 흐름을 개시하는 이벤트를 말한다.
시작 이벤트는 이벤트 이벤트 브로커의 이벤트 채널로 전송되어 처리된다. 이벤트를 관리/제어하는 중재자가 브로커 토포롤지에 없어 단일 이벤트 프로세서는 이벤트 브로커에서 시작 이벤트를 받자마자 관련된 처리작업을 마친 뒤 처리이벤트(processing event)를 생성하고 시스템의 나머지 부분에 자신이 한 일을 비동기로 알린다.

이 처리 이벤트는 필요시 부가적인 처리를 위해 이벤트 브로커에 비동기로 전송된다.

다른 이벤트 프로세서는 처리 이벤트를 리스닝 하고 있다가 이벤트가 들어오면 그에 맞느 작업으 수행한 뒤 다시 새로운 처리 이벤트를 발행함으로써 자신이 한 일을 모두에게 알린다.

이 과정은 최종 이벤트 프로세서가 한 일에 아무도 관심이 없을 떄 까지 되풀이된다.