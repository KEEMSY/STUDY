# **CHAPTER 10 레이어드 아키텍처 스타일**

레이어드 아키텍처(layered architecture, n-tiered)는 가장 흔한 아키텍처 스타일 중 하나이다. 단순하고 대중적이면서 비용도 적게 들어 모든 애플리케이션의 사실상 표준 아키텍처라고 말할 수 있다.

- 개발자와 아키텍트가 어떤 아키텍처 스타일을 정하지 않았다면, 레이어드 아키텍처는 좋은 선택지가 될 수 있다.
- 하지만, 레이어드 아키텍처는 묵시적 아키텍처(architecture by implication) 안티패턴, 우발적 아키텍처(accidental architecture)안티 패턴 등 몇몇 아키텍처 안티패턴의 범주에 속한다.

<br><hr><hr>

## **토폴로지**

*토폴로지는 시스템의 구성 요소 또는 모듈의 배열과 서로 상호 작용하는 방식을 나타낸다.*

레어이드 아키텍처의 내부 컴포넌트는 수평한 레이어들로 구성되며, 각 레이어는 애플리케이션에서 주어진 역할을 수행한다.

- 레이어의 종류에는 프리젠테이션(presentation), 비즈니스(business), 퍼시스턴스(persistence) , 데이터베이스(database)의 4개 표준 레이어로 구성한다.
- 규모가 작은 애플리케이션은 3개, 덩치가 크고 복잡한 비즈니스 애플리케이션은 5개 또는 그 이상의 레이어로 구성된다.
- 각 레이어는 관심사의 분리(seperation of concerns)의 개념을 통해, 아키텍처 내부의 역할 및 책임 모델을 효과적으로 구성할 수 있다.
- 특정 레이어에 소속된 컴포넌트는 역할 범위가 한정되며 그 레이어에 알맞은 로직만 처리한다.
- 이에 대한 트레이드오프로, 개발자의 기술 역량을 도메인의 (프리젠테이션 로직, 퍼시스턴스로직 등)기술적인 부분에 집중시킬 수 있으나, 전체적인 민첩성(변화에 신속하게 반응하는 능력)이 떨어지게 된다.

<br>

*프리젠테이션 레이어는 고객 데이터를 조회하는 방법은 알 필요도 없고 그럴 이유도 없다. 그저 자신이 받아온 정보를 화면에 보기 좋게 보여주기만 하면된다. 마찬가지로, 비즈니스 레이어는 고객 데이터를 어디서 가져올지, 화면에는 어떻게 보여줄지 전혀 관여하지 않는다. 퍼시스턴스 레이어에서 데이터를 가져와 (값을 계산하거나 취합하는 등) 비즈니스 로직을 수행한 결과 데이터를 프리젠테이션 레이어에 잘 전달하기만 하면 된다.*

<br>

> ### **레이어드 아키텍처는 도메인 분할 아키텍처와는 반대의 기술 분할 아키텍처이다.**

레이어드 아키텍처는 컴포넌트를 (고객 같은) 도메인 단위로 묶는 것이 아닌, 아키텍처의 (프리젠테이션 혹은 비즈니스 같은) 기술 역할에 따라 묶기 때문에 비즈니스 도메인이 각각 모든 아키텍처 레이어에 분산된다.

- 고객 도메인은 프리젠테이션, 비즈니스, 규칙, 서비스, 데이터베이스 모든 레이어에 다 포함되어 이 도메인에 어떤 변경을 가하기는 쉬운 일이 아니다.
- 레이어드 아키텍처에 (어울리지 않는)도메인 주도 설계방식은 하지 말도록 하자.

<br><hr><hr>

## 레이어 격리

![layeredArchitecture](/img/layeredArchitecture.png)

레이어드 아키텍처의 각 레이어는 폐쇄(closed) 또는 개방(open) 상태이다.

- 폐쇄 레이어(closed layer)는 요청이 사우이 레이어에서 하위 레이어로 이동하므로 중간의 어떤 레이어도 건너 뛸 수 없고 현재 레이어를 거쳐야 바로 다음 레이어로 나아갈 수 있음을 의미한다.
- 추월차선 리더 패턴(fast-lane reader pattern) 단순 조회 요청이라면 불필요한 레이어를 건너뛰고 프리젠 테이션 레이어가 데이터베이스를 직접 엑세스 하는 것을 말한다.
- 요청이 레이어를 건너뛰기 위해서는 비즈니스 레이어, 퍼시스턴스 레이어는 개방이 되어있어야 한다.

<br>

> ### **레이어 격리**

레이어 격리란, 어느 아키텍처 레이어에서 변겅이 일어나도 다른 레이어에 있는 컴포넌트에 아무런 영향을 끼치지 않아 레어어 간 계약은 불변함을 의미한다.

- 각 레이어는 서로 독립적으로 작동되며, 다른 레이어의 내부 작동 로직은 거의/전혀 알지 못한다.
- 레이어 격리를 지원하기 위해서는 요청의 메인 흐름에 관한 레이어가 반드시 폐쇄 되어 있어야 한다.
- (잘 정의된 계약과 비즈니스 위임 패턴;busioness delegate pattern)레이어를 격리하면 아키텍처의 모든 레이어를 다른 레이어에 영향을 주지않고 교체할 수 있다.

<br>

*프레젠테이션 레이어가 퍼시스턴스 레이어에 직접 엑세스 할 수 있으면 퍼시스턴스 레이어에서 변경이 발생할 경우 비즈니스 레이어, 프리젠테이션 레이어 모두 영향을 받게도고, 결국 컴포넌트 간의 레이어 상호 의존도가 높아져 단단히 커플링된 애플리케이션이 만들어 지게 된다.*