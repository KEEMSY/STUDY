# Concurrency 동시성

동시성은 우리 주변 모든 곳에서 일어나는 현상이다. 즉, 실제 세상의 현상을 이해하고 이들을 잘 모델링 하거나 시물레이션 하려면 우리의 컴퓨터 역시 동적으로 움직여야 한다.
- 동시 컴퓨팅은 한 번에 여러 일을 할 수 있다.
- 동시 컴퓨팅이 없다면 우리가 만든 애플리케이션은 실제 세상의 복잡함을 따라갈 수 없을 것이다.

## 동시성이 중요한 이유

고성능 애플리케이션과 동시성을 갖춘 시스템을 만들ㄹ려면 동시성 프로그래밍 기술이 필요하다.
- 한정된 자원을 갖고 빠른 성능을 얻으려면 동시성을 활용해야한다.
- 동시성은 처리율일 저하되는 것을 막아 줄 수 있다.

> 성능을 측정하는 방법: 지연시간과 처리율
> 높은 처리율을 위해 꼭 지연시간이 짧을 필요는 없으며, 성능을 최적화 할 때, 인자하나(예. 처리율)을 개선했을 때 또 다른 인자(지연시간)이 악화 될 수도 있다.
> - 지연시간(latency): 단일 작업을 시작해 끝날 때까지 걸리는 시간
> - 처리율(throughput): 단위 시간당 시스템이 처리하는 작업의 수

동시성을 사용하면 다음 세 가지 방법으로 시스템 성능을 개선할 수 있다.
- 지연 시간 줄이기(한 가지 작업을 더 빨리 처리하기)
- 지연 시간 숨기기(지연 시간이 긴 작업 중에 다른 일을 함께 처리하기)
- 처리율 개선하기(같은 시간동안 시스템이 더 많은 작업을 처리한다.)

## 순차적 프로그래밍

순차적 프로그래밍은, 연속되는 단계를 통해 문제를 해결하며 각 단계는 이전 단계의 결과물을 필요로 하며 각 단계는 이어지는 단계의 실행을 block 한다.

- 순차 컴퓨팅은 어떠한 프로그램에도 적용할 수 있다.
- 명확하며 예측 가능하다.
- 순차 컴퓨팅의 성능 확장이 제한적이다.(수직확장으로 제한된다.)
- 시스템의 가용자원을 모두 사용하지 않아 효율성이 떨어지고 불필요한 비용이 발생할 수 있다.(싱글 코어 시스템 조차도 모두 사용하지 못할 수 있음)

> 동시성은 임의의 순서로 실행해도 같은 결과를 낳는 독립적인(independent)연산이 있다는 것을 전제로 삼는 개념을 말한다

## 병렬 컴퓨팅

크고 복잡한 문제를 여러 개의 작은 작업으로 분해하고, 이 작업들을 런타임 시스템 계층에서 실행해 문제를 효율적으로 해결하는 방식을 말한다.
- 어떤 문제에 병렬 컴퓨팅을 적용하기 위해서는 해당 문제를 여러 개의 독립적인 작업으로 분해해서 처리자원이 각 작업의 알고리즘을 동시에 실행하는데 문제가 없어야 한다.
- 병럴 실행 가능한 프로그램은 모두 순차 실행이 가능하지만, 그 반대는 성립하지 않는다.(순차 실행할 수 있는 프로그램이 모두 병렬 실행이 가능하지는 않다.)

> **병렬 컴퓨팅 관련 법칙들**
> 
> **암달의 법칙 (Amdahl's Law)**
> - 병렬화할 수 없는 순차적 부분이 전체 성능 향상을 제한함
>   - 문제의 크기는 고정한 채 병렬 프로그램의 실행 시간이 얼마나 줄어드는지를 다룬다.
> - 공식: `최대 속도 향상 = 1 / (순차적 부분의 비율)`
> - 예시: 순차적 부분이 2/3라면 → 최대 1.5배 속도 향상
> 
> **구스타프슨의 법칙 (Gustafson's Law)**  
> - 문제 크기를 키우면 병렬화 효과를 더 얻을 수 있음
>   - 작업의 양을 계속 늘릴 수 있다면 프로그램의 순차적인 부분의 영향은 점점 줄어들고 프로세서의 수를 늘릴 때마다 일정 수준의 속도 증가 효과를 볼 수 있음 
> - 고정된 시간 내에 더 큰 문제를 해결하는 것이 목표
> - 프로세서 수에 비례해 처리할 수 있는 작업량이 증음


## 동시성 VS  병렬성

동시(concurrent)와 병렬(parallel)은 대부분 동의어로 사용되나, 동시성 프로그래밍과 병렬 프로그래밍은 다르다.
- 동시성: 여러 작업을 시작, 실행, 완료하는 과정이 서로 중첩된 시간에서 특별히 정해진 순서 없이 일어나는 것
  - 작성된 프로그래밍 언어와 코드에 좌우 됨
- 병렬성: 여러 작업을 여러 컴퓨팅 자원(ex.멀티 프로세서)을 이용해 병렬로 동시에 실행하는 것
  - 작업을 물리적으로 동시에 실행하는 것으로, 하드웨어 계층의 개념이다.(실제 실행 환경에 큰 영향을 받는다.)
  - 구현의 속성(implementation property)에 해당한다.
  - 동시성의 일종이다.

> 동시성 그 자체는 병렬성을 담보히지 않으며, 병렬성 역시 그 자체로는 동시성을 담보하지 않는다.
> - "동시성은 여러가지를 한 번에 다루는 것이지만, 병렬성은 여러 가지 일을 동시에 하는 것" - 롭 파이크

<br>

**동시성과 병렬성의 차이를 돕기위한 포인트**

- 애플리케이션은 동시적이지만 병렬적이지 않을 수 있다. 일정한 시간동안 두 가지 이상의 일(동시에 하지 않더라도 두 가지 일을 번갈아 가면서 할 수 있다.)
- 애플리케이션은 병렬적이지만 동시적이지 않을 수 있다.단일 작업을 하위 작업 여러 개를 동시에 처리하는 경우가 이에 해당한다.
- 애플리케이션은 병렬적이지도 동시적이지도 않을 수 있다. 한 번에 한 가지 작업을 순차적으로 처리하며, 이 작업을 구성하는 하위 작업이 없을 때 해당한다.
-  애플리케이션은 병렬적이면서 동시적일 수 있다. 여러 개의 작업을, 또는 단일 작업의 하위 작업 여러 개를 동시에(그리고 병렬로) 실행해서 처리할 때 해당한다.
- 동시 알고리즘을 묘사할 때 구현에 사용할 특정 플고그래밍 언어를 알 필요보다는, 알고리즘을 실행할 컴퓨터 시스템의 특징을 알아야 한다.

<br>

> **동시성과 관련된 주제들**
> 아래의 주제들은 멀티 프로세서나 분산 처리 환경에서만 발생하는 것은 아니며, 단일 프로세서 시스템에서도 일어날 수 있는 문제이다.
> - 프로세스 간 상호작용
> - 자원(메모리 또는 파일, 입출력 접근)의 공유와 경쟁
> - 프로세스 간 동기화
> - 프로세스 간의 프로세서 시간 할당 등


<br>

## 동시 하드웨어의 다양한 수준

### 비트 및 명령어 수준 병렬성
- **비트 수준 병렬성(bit-level parallelism)**: 데이터 폭을 늘려 한 번에 더 많은 비트를 처리
  - 8비트 → 16비트 → 32비트 → 64비트 프로세서 발전
- **명령어 수준 병렬성(instruction-level parallelism)**: 명령어를 여러 부분으로 나누어 각기 다른 회로에서 동시 수행
  - 파이프라이닝: 명령어 처리 단계를 겹쳐서 실행
  - 슈퍼스칼라: 여러 명령어를 동시에 실행

### 스레드 수준 병렬성
- **하이퍼스레딩(Hyper-Threading)**: 하나의 물리적 코어에서 여러 스레드를 동시 실행
  - CPU 파이프라인의 유휴 시간을 활용
- **멀티 스레딩**: 컨텍스트 스위칭을 통해 여러 스레드 간 전환

### 프로세서 수준 병렬성
- **멀티 프로세서(multiprocessor)**: 한 컴퓨터에 두 개 이상의 독립된 프로세서
  - 각 프로세서는 별도의 칩에 존재
- **멀티 코어 프로세서(multicore processor)**: 하나의 칩에 여러 프로세서 코어
  - 각 코어는 독립적으로 동작
  - 운영체제는 각 코어를 별개의 프로세서로 인식
  - 코어 간 통신 속도가 멀티 프로세서보다 빠름

### 시스템 수준 병렬성
- **SIMD(Single Instruction, Multiple Data)**: 하나의 명령어로 여러 데이터를 동시 처리
  - GPU의 주요 처리 방식
  - 벡터 연산, 이미지/영상 처리에 효과적
- **분산 시스템**: 네트워크로 연결된 여러 컴퓨터가 협력하여 작업 처리
  - 클러스터 컴퓨팅, 클라우드 컴퓨팅

> **메모리 관련 고려사항**
> - **캐시 일관성**: 여러 프로세서가 공유 메모리에 접근할 때 데이터 일관성 유지 필요
> - **NUMA(Non-Uniform Memory Access)**: 프로세서마다 메모리 접근 속도가 다른 구조
> - 메모리 대역폭이 병렬 성능의 병목이 될 수 있음

**병렬성 수준별 적용 분야**
- 비트/명령어 수준: 모든 현대 프로세서의 기본 기능
- 스레드 수준: 멀티태스킹 운영체제, 서버 애플리케이션
- 프로세서 수준: 과학 계산, 데이터베이스, 웹 서버
- 시스템 수준: 빅데이터 처리, 머신러닝, 분산 서비스