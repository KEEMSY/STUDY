# Consistency 일관성
객체지향 프로그래밍에서 `일관성`이란, 객체가 정확하고 신뢰할 수 있는 정보를 가지고 있음을 나타낼 때 사용된다.
- `무결성`(integrity): 데이터 베이스와 같은 다른 컴퓨터 과학분야에서 사용되며, 정보를 정확하게 유지하는 것을 의미한다.
  - 데이터베이스에서의 일관성은 데이터의 `가용성`과 관련이 있다.


객체지향 프로그래밍의 가장 중요한 장점은 객체가 항상 일관된 상태를 유지하도록 보장한다는 것이다.
따라서 객체지향 프로그래밍을 하기 위해서는 `일관성`을 유지하는 방법을 알아야 하며, 항상 `일관성`을 유지해야 할 수 있어야 한다.
- 객체가 `일관성`을 유지한다면, 객체의 내부상태가 프로그램 요구사항이나 사용자 기대에 잘 맞춰 조화를 이룰 수 있게 된다.
- 객체가 `일관성`을 유지한다면, 객체가 올바르게 동작하며 정확한 결과를 제공하므로 고장이 적고, 신뢰할 수 있는 소프트 웨어를 만들 수 있다.

> 캡슐화(encapsulation)
> - 데이터를 객체 안에 저장하고 연산을 통해서만 이를 조작할 수 있게 하는 개념
> - 캡슐화를 통해 코드 기반의 다른 부분에 영향을 주지 않고 클래스 내부의 세부 사항을 변경할 수 있다.


## 캡슐화를 유지하는 방법
> 1. 항상 일관성을 유지한다.
> 2. 효과적인 데이터 유효성 검사 메커니즘을 디자인한다.
> 3. 상태 확인을 캡슐화 한다.
> 4. 필요한 게터와 세터만 제공한다.
> 5. 객체 집단의 불변 조건을 보장하도록 애그리게이트를 모델링한다.

### 1. 항상 일관성을 유지한다.
**1.1 클래스가 스스로 일관성을 책임지게 한다.**

어떤 클래스가 데이터 일고나성을 책임져야 할지 확신이 서지 않을 때에는 데이터를 포함하는 클래스가 일관성을 보장하도록 만드는 것이 좋다.
- 클래스는 항상 상태를 일관성 있게 유지해야할 책임이 있다.

**1.2 전체 작업과 복잡한 일관성 검사를 캡슐화 한다.**
객체 내부에 있는 정보만으로는 일관성 검사가 불가능하거나 너무 복잡해서 클래스 밖에 구현해야할 수도 있다. 이런 경우, 일관성 검사와 비즈니스 로직을 별도의 클래스로 캡슐화 하는 것이 필요하다.
- 이 역할을 하는 것이 서비스 클래스 이다.
  - 서비스 클래스는엔터티가 스스로 제공할 수 없는 일관성을 보장한다.

클라이언트는 절대 일관성 검사를 책임지지 않아야하며, 기본적으로 클래스가 일관성을 검사해야 한다.

> **도메인 클래스**
>
>도메인 클래스는 가능한 순수한 상태를 유지해야 하며, 데이터와 그 데이터를 조작하는 메서드만 포함하는 것이 낫다.


### 2. 효과적인 데이터 유효성 검사 메커니즘을 디자인한다.

클라이언트의 데이터 유효성 검사는 예상치 못한 오류를 방지하고 시스템의 이상 동작 위험을 줄인다. 이를통해 시스템이 문제를 보다 잘 처리하고 의사소통 할 수 있게 보장할 수 있다.
- 잘못된 데이터가 야기할 결과를 명확히 정의한다.
- 코드의 신뢰성과 사용자 경험을 증진 시킬 수 있다.

**2.1 사전 조건을 명시적으로 정의한다.**
능동적으로 메서드의 사전 조건과 사후 조건을 명시적으로 정의하고 문서화 해야 클래스가 의도대로 쓰일 가능성을 높이고 일관되지 않은 프로그램 실행을 줄일 수 있다.
- 사전조건: 각 입력이 어떤 값일 때 유효한지를 명확히 정의하는 것을 말한다.
  - 클라이언트가 메서드의 사전 조건을 만족시키지 않을 때 어떤 일을 해야 할지 결정하는 것은 개발자의 책임이다.
  - 코드의 사전 조건을 단순화하면 클라이언트가 처리해야 할 드물게 발생할 수 있는 예외 케이스도 줄어들기 때문에 클라이언트도 더 편해지게 된다.

> 잘못된 데이터의 처리할 방법을 모를 때, 프로그램을 계속 실행하는 것보다는 중단시키는 편이 더 낫다.

> 서비스 클래스: 흐름을 제어하고, 유혀성 검증과 일관성 검사를 동작 전에 실행하도록 보장하는 클래스
> - 어떤 동작을 수행하기 전에 검증 규칙을 호출해야한다는 사실을 알 필요가 없도록 만들 수 있다.
> - 복잡한 비즈니스 동작에 대해 서비스 클래스를 사용하여 조정하는 것은 합리적인 타협안이 될 수 있다.
> - 엔터티는 여전지 자신이 할 수 있는 모든 일관성 검사를 수행해야 한다.

**2.2 유효성 검증 컴포넌트를 만든다.**
검증 컴포넌트는 일관성을 유지하는데 도움이된다.
- 클라이언트가 검증 메서드를 호출할 때 재사용성과 명확성을 높일 수 있다.
- 검증 규칙은 특정 기능이나 서비스에 특화되어 있으므로, 검증 클래스를 과도하게 디자인하는 것은 경계해야 한다.
유연한 검증 규칙을 구축하는 방법으로 명세 패턴(specification Pattern)을 고려할 수 있다.

> 검증 규칙: 비즈니스와 밀접하게 관련이 있는 조건
> - 예시: 직원은 같은 교육 과정을 세 번 이상 수강할 수 없다 등

**2.3 null 사용은 신중하게 하고 피할 수 있다면 피한다.**
null은 예기치 않은 null포인터 예외를 유발하며, null 검사를 과도하게 하면 가독성이 나빠질 수 있다.
- 메서드의 실행 경로 중 아무것도 반환하지 않아야 하는 경우, '값 없음'을 나타내는 객체를 생성하여 반환하는것이 좋다.
- null을 사용하지 않도록 모델링 할 수 없다면, 예상치 못한 놀라움을 피하는 것이 최선이다. 

### 3. 상태 확인을 캡슐화 한다.
복잡도와 관계없이 상태 확인을 캡슐화 한다면, 클라이언트가 클래스의 내부 세부 정보를 알지 못하게 할 수 있고, 클래스 내부의 구현이 변경되어도 클라이언트에 영향을 주지 않을 수 있다.
- 아주 단순한 상태 검사까지 캡슐화하면 시간을 절약하고 유연성을 제공할 수 있다.
- 클라이언트가 클래스의 내부 작동을 이해할 필요를 없앰으로써, 클래스가 내부를 자유롭게 수정할 수 있게 된다
